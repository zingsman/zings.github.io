<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="业精于勤荒于嬉,行成于思毁于随。">
<meta property="og:type" content="website">
<meta property="og:title" content="ZingsMan">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ZingsMan">
<meta property="og:description" content="业精于勤荒于嬉,行成于思毁于随。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZingsMan">
<meta name="twitter:description" content="业精于勤荒于嬉,行成于思毁于随。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> ZingsMan </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZingsMan</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-search">
          <a href="/search" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-search"></i> <br />
            
            搜索
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/shell-if-语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/04/shell-if-语句/" itemprop="url">
                  shell_if_语句
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T09:38:56+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="shell脚本if语句的几种写法和格式"><a href="#shell脚本if语句的几种写法和格式" class="headerlink" title="shell脚本if语句的几种写法和格式"></a>shell脚本if语句的几种写法和格式</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>if条件判断语句，是控制流的非常重要的核心。自己在写shell脚本时候，总是忘记格式和写法。<br>if后面的条件判断语句，如果为真 0 ，就会执行then里面的表达式，如果为假，就会忽略then里面的命令。执行else里面的语句。else是匹配最近的一条if语句</p>
<h3 id="单分支结构"><a href="#单分支结构" class="headerlink" title="单分支结构"></a>单分支结构</h3><p>下面的条件表达式可以是： <strong>test命令</strong>,<strong>[ ]</strong>, <strong>[[]]</strong> ,<strong>(())</strong>，<strong>其他命令</strong></p>
<ul>
<li><p>第一种语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if  &lt;条件表达式&gt;</div><div class="line">    then</div><div class="line">        指令</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
<li><p>第二种语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if &lt;条件表达式&gt;;then</div><div class="line">    指令</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
</ul>
<p>-第三种语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if &lt;条件语句&gt;;then</div><div class="line">    if &lt;条件语句&gt;;then</div><div class="line">        指令1</div><div class="line">    fi</div><div class="line">    if &lt;条件语句&gt;;then</div><div class="line">        指令2</div><div class="line">    fi</div><div class="line">    指令0</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<h3 id="双分支结构"><a href="#双分支结构" class="headerlink" title="双分支结构"></a>双分支结构</h3><ul>
<li>第一种语法<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if &lt;条件语句&gt;;then</div><div class="line">    指令1</div><div class="line">else</div><div class="line">    指令2</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="多分支结构"><a href="#多分支结构" class="headerlink" title="多分支结构"></a>多分支结构</h3><ul>
<li>第一种语法<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if &lt;条件语句&gt;;then</div><div class="line">    指令1</div><div class="line">elif</div><div class="line">    then</div><div class="line">    指令2</div><div class="line">elif </div><div class="line">    then</div><div class="line">    指令3</div><div class="line">else</div><div class="line">    指令4</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注意</strong> 多分支结构，每个elif都要带then，耳而最后的else，是不能带else的。</p>
<h3 id="if语句执行步骤"><a href="#if语句执行步骤" class="headerlink" title="if语句执行步骤"></a>if语句执行步骤</h3><p>if –&gt;（真）–&gt;指令<br>if –&gt;（假）–&gt;elif–&gt;（真）–&gt;指令<br>if –&gt;（假）–&gt;elif–&gt;（假）–&gt;ellse–&gt;指令</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/31/Vmware-6-5-Install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/31/Vmware-6-5-Install/" itemprop="url">
                  Vmware_6.5_Install
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-31T09:11:46+08:00">
                2017-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vmware-搭建vsan集群教材"><a href="#vmware-搭建vsan集群教材" class="headerlink" title="vmware 搭建vsan集群教材"></a>vmware 搭建vsan集群教材</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>由于工作相关。以前自己看的明教教主的vmware5.5教学视频隔了很长一段时间。也没有动。最近在vmware官方试着安装了vsphere 6.5 一系列。</p>
<h2 id="简单知识点"><a href="#简单知识点" class="headerlink" title="简单知识点"></a>简单知识点</h2><ul>
<li>vmware 就是底层虚拟化技术。实现主机资源（cpu，内存，）和存储（光纤存储，iscsi）分离。集中管理，节约成本的很多功能。</li>
<li>vcenter 是vmware非常重要的主机。能够实现负载均衡，冗余等（上行链路），能够实现高可用性（HA），动态资源分配（DRS）。在线迁移等等一系列技术。</li>
<li>要实现vmware的HA和DRS的很多功能，前提条件是需要有 <strong>共享存储</strong> 比如：<code>FC</code> 和 <code>ISCSI</code> 。在实验环境没有这些，可用通过vmware的VSAN(Vphere Storage Area Network)技术.他是vmware的 存储技术<h2 id="下载软件"><a href="#下载软件" class="headerlink" title="下载软件"></a>下载软件</h2>链接：<a href="https://www.vmware.com/cn.html" target="_blank" rel="external">https://www.vmware.com/cn.html</a> 可以在官网注册账号免费评估，即可下载</li>
</ul>
<ol>
<li>VMware vSphere Hypervisor (ESXi ISO) image (Includes VMware Tools) 这个 esxi 6.5主机系统</li>
<li>VMware vCenter Server and modules for Windows 下载linux版的或者windows版的vcenter，这里我下载windows的vcenter</li>
<li>linux安装vcenter简单，中移教程文档里面有。<h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3>环境使用公司vmware上一条虚拟机（16C32G）装workstation虚拟机来完成。默认情况下，虚拟机是不支持64位虚拟化。需要打开cpu虚拟化功能。需要在网页版vcenter上虚拟机设置里面cpu设置。<br>一共有5台虚拟机。3台esxi主机（4C8G）一台windows server 2012 sp2 安装vcenter（4C8G）。一台windows server 2012（4C-8G）装NTP服务器和DNS服务器。<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3></li>
<li>安装3台esxi主机，并配置相应的网络。设置静态ip，DNS，esxi主机自己名字，我dns前缀</li>
<li>安装1台虚拟机，做NTP服务器，和DNS服务器。配置如下：<br>首先安装NTP服务器：<br>打开注册表; regedit 依次打开：<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time\Parameters\Type<br>双击 AnnounceFlags文件，将值改为5<br>双击  Enabled文件 将值改为1<br>关闭注册表，重启windows 时间服务<br><code>$ net stop w32time</code><br><code>$ net start w32time</code><br>若关闭防火墙，则不需要加入规则，开启则加入防火墙规则：<br><code>netsh firewall add portopening protocol = UDP port =123 name = NTPSERVER</code><br>设置 win32time服务<br><code>gpedit.msc</code><br>执行上述命令后，计算机策略对话框打开，按照如下路径  计算机配置\管理模板\系统\windows 时间服务\时间提供程序 找到服务器设置文件。<br>双击  启用 Windows NTP 服务器，显示状态 已启用即可<br>修改本地启动模式<br>运行服务<code>services.msc</code>,找到  Windows Time 文件,点击属性，改为延迟自动启动。</li>
</ol>
<p>dns服务器安装：<br>打开角色服务器管理器，点击新建服务器角色。下一步，选择dns服务器。安装即可。<br>安装后在服务器管理器页面有dns服务器。点击进去，添加正向解析区域。添加主机即可。</p>
<ol>
<li>安装vcenter<br>安装center，把下载的iso挂着在cd上。里面有个自动运行的文件。直接自动运行，填写好相关的信息。直接安装。</li>
<li>安装成功后。登录vcenter上面。注意登录名是时候 vcenter@pengke.com 注意是@</li>
<li>添加规则：<br>先键数据中心，再建vsan集群（建立时候选择打开vsan）。打开HA和DRA等<br>在做vsan时候，必须声明一个缓存盘和容量盘，所以，除了系统盘，至少还需要2快盘。其中一块盘，必须是SDD（闪存类型）（默认是HDD）。一块即可。配置的交换机就必须是混杂模式了。<br>将默认的HDD改为SDD：<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">esxcli storage core device list # 查看硬盘信息并找到相关盘符</div><div class="line">esxcli storage nmp satp rule add --satp VMW_SATP_LOCAL --device mpx.vmhba0:C0:T1:L0 --option "enable_local enable_ssd" #建SATP规则，并将可选参数设置为enable_ssd，注意磁盘编号</div><div class="line">esxcli storage nmp satp rule list | grep enable_ssd #查看刚才创建的规则</div><div class="line">esxcli storage core claiming reclaim -d mpx.vmhba0:C0:T1:L0 #重新申明磁盘，也只有盘符</div><div class="line">esxcli storage core device list -d mpx.vmhba0:C0:T1:L0 #验证</div><div class="line"><span class="meta"></span></div><div class="line">#若想将SSD重新恢复至HDD，则执行</div><div class="line"> esxcli storage nmp satp rule remove --satp VMW_SATP_LOCAL --device="mpx.vmhba0:C0:T1:L0"</div><div class="line"> esxcli storage core claiming reclaim -d mpx.vmhba0:C0:T1:L0</div><div class="line"> esxcli storage core device list -d mpx.vmhba0:C0:T1:L0</div></pre></td></tr></table></figure>
</li>
</ol>
<p>做vsan，只需一块改为hdd就行，我这hdd用来做缓存盘。</p>
<ol>
<li>vsan的流量，需要vmkernel交换机，也可以使用默认的switec 0 也可以专门创建新的交换机来跑vsan流量。我直接使用的默认交换机。将所有HA，Vmotion。vsan等流量都往上面跑。</li>
<li>配置好交换机后。设置vsan配置<br>在vsan集群中，添加3个主机，配置点击存储配置。将3个主机的磁盘声明下，我有出系统盘后，2个磁盘。一个100G SDD 声明为 缓存盘，一个150 HDD声明为容量盘。就能看的3个主机vsan盘的数据盘变成了 450G。<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>写文档写得匆忙，在自己配置过程中遇到了很多问题，开始安装好后登录。不知道加@。<br>安装好vcenter时，登录进去，直接新建数据中心，就直接添加主机，导致各个主机上虚拟机不能兼容迁移。应该 新建数据中心-新建集群-新建主机，才合理。还有管理网络配置，配置标准交换机，配置vmkernel交换机，配置分布式交换机。等。最后，HA功能和drs功能没有测试。找机会测试下。还有就是vmware6的主机聚集和主机互斥功能没有找到。带测试。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/18/python-picture-to-ascii/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/18/python-picture-to-ascii/" itemprop="url">
                  python_picture_to_ascii
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T11:15:26+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="将图片转换成字符串图片"><a href="#将图片转换成字符串图片" class="headerlink" title="将图片转换成字符串图片"></a>将图片转换成字符串图片</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>学习python，作为入门python的基础项目。实验地址:<br><a href="https://www.shiyanlou.com/courses/370/labs/1191/document" target="_blank" rel="external">https://www.shiyanlou.com/courses/370/labs/1191/document</a></p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>pyhon 2.7环境</li>
<li>使用库 argparse库。参考： <a href="https://blog.ixxoo.me/argparse.html" target="_blank" rel="external">https://blog.ixxoo.me/argparse.html</a></li>
<li>实验 pillow(PIL) 库 <code>from PIL import Image</code></li>
<li>Python 基础<h2 id="大概思路"><a href="#大概思路" class="headerlink" title="大概思路"></a>大概思路</h2><strong>用颜色灰度值（0黑~255白）转换成对应的字符串**</strong><br>一般读取图片坐标，我们得到的是RGB值。将图片RGB值转换为灰度：<br><code>gray ＝ 0.2126 * r + 0.7152 * g + 0.0722 * b</code><br>我们处理要转换的图片，输入几个参数（argument库的使用）：</li>
</ul>
<ol>
<li>图片路径（必须参数）</li>
<li>另存字符画的路径（默认当前目录output.txt）(可选参数)</li>
<li>图片的长和宽(可选参数)<h3 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a>处理过程</h3></li>
<li>首先，读取我们输入的参数。</li>
<li>使用PIL.image库打开我们的图片</li>
<li>通过for循环，对长宽的坐标进行循环，并处理<code>getpixel((j,i))</code>得到我们的RGB值。</li>
<li>将RGB值转到我们转换的字符串的函数中。输出相应的灰度值</li>
<li>显示结果</li>
</ol>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#use python 2.7</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image <span class="comment">#使用pillow库</span></div><div class="line"><span class="keyword">import</span> argparse   <span class="comment">#使用argparse 库，能方便的处理参数</span></div><div class="line"></div><div class="line"><span class="comment"># command argument</span></div><div class="line"></div><div class="line">parser = argparse.ArgumentParser() <span class="comment">#定义一个变量对象，来设置参数信息</span></div><div class="line"></div><div class="line">parser.add_argument(<span class="string">"file"</span>,help = <span class="string">"input your picture"</span>)</div><div class="line"> <span class="comment"># "file"为必要参数。有--代表可选参数</span></div><div class="line">parser.add_argument(<span class="string">"-o"</span>,<span class="string">"--output"</span>, help = <span class="string">"if you want,input you result file"</span>) </div><div class="line"><span class="comment"># “-o”,是"--output"参数的简写。可选参数</span></div><div class="line">parser.add_argument(<span class="string">"--width"</span>,type = int, default = <span class="number">80</span>) </div><div class="line"><span class="comment">#定义可选参数，类型，和默认值</span></div><div class="line">parser.add_argument(<span class="string">"--height"</span>, type = int, default = <span class="number">80</span>)</div><div class="line"></div><div class="line">args = parser.parse_args()  <span class="comment"># 定义变量来获取参数</span></div><div class="line"></div><div class="line">IMG = args.file  <span class="comment">#文件图片</span></div><div class="line">WIDTH = args.width  <span class="comment"># 宽</span></div><div class="line">HEIGHT = args.height <span class="comment"># 高</span></div><div class="line">OUTPUT = args.output <span class="comment"># 另存为地址</span></div><div class="line"></div><div class="line">ascii_char = list(<span class="string">"$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1&#123;&#125;[]?-_+~&lt;&gt;i!lI;:,\"^`'. "</span>)  </div><div class="line"><span class="comment"># 我们将0-255的颜色灰度值转换成这些字符串，即是越接近0，用越左边的字符串表示</span></div><div class="line"></div><div class="line"><span class="comment"># 256 clocr to 70 charstrings</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_char</span><span class="params">(r,g,b,alph = <span class="number">256</span>)</span>:</span></div><div class="line">    <span class="comment"># 为什么plph值默认值为:256, 而getpixel()穿过来的是[2,255]</span></div><div class="line">    <span class="keyword">if</span> alph == <span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> <span class="string">' '</span></div><div class="line">    length = len(ascii_char)</div><div class="line">    gray = int(<span class="number">0.2126</span> * r + <span class="number">0.7152</span> * g + <span class="number">0.0722</span> * b)  <span class="comment">#灰度值的计算公式，固定</span></div><div class="line"></div><div class="line">    unit = (<span class="number">256.0</span> + <span class="number">1</span>)/length</div><div class="line">    <span class="keyword">return</span> ascii_char[int(gray/unit)]</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:   </div><div class="line"><span class="comment"># 好习惯编程，别人import你的模块，不会执行里面的内容</span></div><div class="line"></div><div class="line">    im = Image.open(IMG)  <span class="comment">#打开图片对象，用im，使用PIL.Image库</span></div><div class="line">    im = im.resize((WIDTH,HEIGHT),Image.NEAREST) </div><div class="line">    <span class="comment">#充值图片大小，就是返回你定义的长高图片对象.Image.NEAREST是默认方式。可以不研究.</span></div><div class="line">    <span class="comment">#第二个参数resample有四个选项，分别是Image.NEAREST、Image.BILINEAR、Image.BICUBIC、Image.LANCZOS，默认是第一个，第四个质量最高。</span></div><div class="line">    txt = <span class="string">""</span> <span class="comment">#初始化txt</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(HEIGHT):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(WIDTH):</div><div class="line">            txt += get_char(*im.getpixel((j,i)))</div><div class="line">            <span class="comment"># get_char（r,g,b,alph）有四个参数。我们使用im.getpixel()</span></div><div class="line">            <span class="comment">#函数，是得到某坐标(j,i) 图片的RGB值，和另一个参数，跟图片类型相关</span></div><div class="line">            <span class="comment"># 即是getpixel((j,i)) 得到值(R值，G值，B值，A值) 这里A值就是色彩空间。将A值穿给</span></div><div class="line">            <span class="comment"># get_char()函数的 alph。</span></div><div class="line">            <span class="comment">#这里使用 * 号，是对元组的拆封过程，会返回对应元组的所有对象。</span></div><div class="line"></div><div class="line">        txt += <span class="string">'\n'</span></div><div class="line">    <span class="keyword">print</span> txt</div><div class="line">    <span class="keyword">if</span> OUTPUT:</div><div class="line">        <span class="keyword">with</span> open(OUTPUT,<span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(txt)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">with</span> open(<span class="string">"output.txt"</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(txt)</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>网上问题答疑:</p>
<ol>
<li><code>*im.getpixel((j, i))</code>返回的是什么？为什么要加“ <em> ”？<br>答:返回的是一个元组，这个元组有三个元素，分别对应三个颜色通道（RGB）的值。<br>`</em><code>是一个运算符，对元组使用</code><em><code>运算符即为元组拆封操作。元组拆封会返回元祖的所有元素。
所以表达式</code></em>im.getpixel((j,i))` 返回 3 个值，正好对应 get_char() 函数的三个参数。还有一个值就是对应的get_char()的alph值</li>
<li><code>im = im.resize((WIDTH, HEIGHT), Image.NEAREST)</code>，这里的Image.NEAREST和resize函数是什么意思?<br>答；返回的4个值为:<br> PIL.Image.NEAREST (use nearest neighbour),<br> PIL.Image.BILINEAR (linear interpolation),<br> PIL.Image.BICUBIC (cubic spline interpolation),<br> PIL.Image.LANCZOS (a high-quality downsampling filter)</li>
<li>另答案:<br><code>getpixel</code> : 返回指定位置的像素，如果所打开的图像是多层次的图片，那这个方法就返回一个元组。<br><code>im.getpixel( xy ) =&gt; value or tuple</code><br>本实验中的函数，我的理解是，图片模式应该是RGBA:4元素元组，<br>而且：<code>def get_char(r,g,b,alpha = 256)</code>，这个函数里边也是4个参数。<br>然后，说下我对这个程序的理解：<br>`txt += get_char(im.getpixel((j,i)))``<br>这个函数，首先调用了im.getpixel函数，im.getpixel的参数是（j,i）。（j,i）其实是图片的横纵坐标。通过调用这个函数，把图片的横纵坐标上的颜色，分割成了(r,g,b,alpha)这个四个参数，然后调用get_char这个函数。<br>再说下get_char这个函数是怎么运行的。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_char</span><span class="params">(r,g,b,alpha = <span class="number">256</span>)</span>:</span></div><div class="line"><span class="keyword">if</span> alpha == <span class="number">0</span>: //如果alpha等于<span class="number">0</span>，也就是判断图片现在是不是没有了。</div><div class="line"><span class="keyword">return</span> <span class="string">' '</span></div><div class="line">length = len(ascii_char)//就是上边那一串字符串的长度</div><div class="line">gray = int(<span class="number">0.2126</span> r + <span class="number">0.7152</span> g + <span class="number">0.0722</span> b) //灰度的计算公式</div><div class="line"><span class="comment">#####另外：</span></div><div class="line">unit = (<span class="number">256.0</span> + <span class="number">1</span>)/length</div><div class="line"><span class="keyword">return</span> ascii_char[int(gray/unit)]  //其实这个就是gray*length/<span class="number">257</span>，这个公式相当于按照灰度，在那串字符串中选一个字母。。。</div></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/vim-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/17/vim-use/" itemprop="url">
                  vim_use
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T11:47:27+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vim-编辑器的使用"><a href="#vim-编辑器的使用" class="headerlink" title="vim 编辑器的使用"></a>vim 编辑器的使用</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在日常运维工作中，非常平凡的接触vim编辑器。对vim编辑器的熟悉，是非常重要的事情，往往会大大提高我们的工作效率</p>
<h2 id="vim编辑器的模式"><a href="#vim编辑器的模式" class="headerlink" title="vim编辑器的模式"></a>vim编辑器的模式</h2><p>vim一共有6中模式。但是我们常用的只有 <strong>普通模式</strong>，<strong>编辑模式</strong>，<strong>命令行模式</strong>。只需要了解这几个模式就可以了。</p>
<h3 id="普通模式"><a href="#普通模式" class="headerlink" title="普通模式"></a>普通模式</h3><p>我们使用vim text.txt 进入后，就是默认的普通模式，这里面可以执行光标的移动，内容（对象）的删除的操作。<br>比如：</p>
<ul>
<li><code>yy</code> 复制光标当前行，  <code>2yy</code>就是 复制光标当前2行</li>
<li><code>p</code> 在光标下一行粘贴复制的内容</li>
<li><code>dd</code> 删除光标当前行，  <code>2dd</code>  删除光标一下多少行。<code>d</code>为删除操作，如果你按<code>d</code>,在按下光标，就会删除2行，相当于：<code>2dd</code><h3 id="编辑模式"><a href="#编辑模式" class="headerlink" title="编辑模式"></a>编辑模式</h3>在普通模式下，按<code>i</code> 或者<code>a</code>进入编辑模式。在编辑模式里，可以编辑文本。<br>返回到普通模式按<code>esc</code> 大写的I和A 分别表示在行首和行末插入。<h3 id="命令行模式"><a href="#命令行模式" class="headerlink" title="命令行模式"></a>命令行模式</h3>进入命令行模式，在普通模式下，执行命令按：<code>:+命令</code> 搜索按:<code>/+命令</code> 或者<code>?+命令</code><br>过滤命令(<code>!</code>键)。在命令完成之后，回到原来的模式，通常我普通模式<h2 id="vim退出"><a href="#vim退出" class="headerlink" title="vim退出"></a>vim退出</h2><h3 id="命令退出"><a href="#命令退出" class="headerlink" title="命令退出"></a>命令退出</h3>vim退出有以下几种方式：<br><code>:q!</code> 强制退出，不保存<br><code>:q</code>  退出<br><code>:wq!</code>  强制保存并退出<br><code>:w &lt;文件路径&gt;</code> 文件另存为<br><code>:saveas &lt;文件路径&gt;</code> 文件另存为<br><code>:x</code>  保存并退出<br><code>:wq</code>  保存并退出 <h3 id="快捷键退出"><a href="#快捷键退出" class="headerlink" title="快捷键退出"></a>快捷键退出</h3>在普通模式下 <code>shift + zz</code> 保存并退出<h2 id="常用的vim命令"><a href="#常用的vim命令" class="headerlink" title="常用的vim命令"></a>常用的vim命令</h2><h3 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令:"></a>删除命令:</h3><code>.</code> 重复上一次命令<br><code>x</code> 普通模式下输入<code>x</code>,删除第一个字符<h3 id="文本跳转"><a href="#文本跳转" class="headerlink" title="文本跳转"></a>文本跳转</h3><code>10x</code> 连续删除10个字符<br><code>3dd</code> 连续删除3行<br><code>nG</code> 光标移动到地几行，或者 <code>: 10 G</code><br><code>gg</code> 光标移动到首行<br><code>G</code> 光标移动到尾行<br><code>:set nu</code>  设置显示行号<h3 id="行内跳转"><a href="#行内跳转" class="headerlink" title="行内跳转"></a>行内跳转</h3><code>w</code> 到下一个单词开头<br><code>e</code> 到下一个单词开头<br><code>b</code> 到下一个单词开头<br><code>ge</code> 到下一个单词开头<br><code>0或^</code> 到下一个单词开头<br><code>$</code> 到下一个单词开头<br><code>f&lt;字母&gt;</code> 向后搜字母，并跳到第一个匹配之前的文章<h3 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h3></li>
<li>普通模式中，<code>yy</code>复制游标所在的整行（<code>3yy</code>表示复制3行）</li>
<li>普通模式中，<code>y^</code> 复制至行首，或<code>y0</code>。不含光标所在处字符。</li>
<li>普通模式中，<code>y$</code> 复制至行尾。含光标所在处字符。</li>
<li>普通模式中，<code>yw</code>复制一个单词。</li>
<li>普通模式中，<code>y2w</code>复制两个单词。</li>
<li>普通模式中，<code>yG</code>复制至文本末。</li>
<li>普通模式中，<code>y1G</code>复制至文本开头。<br><strong>粘贴</strong></li>
<li>普通模式中，<code>p</code>(小写)代表粘贴至光标后（下）</li>
<li>普通模式中，<code>P</code>(大写)代表粘贴至光标前（上）<br><strong>剪切</strong><br>其实前面讲得<code>dd</code>删除命令就是剪切，你每次<code>dd</code>删除文档内容后，便可以使用p来粘贴，也这一点可以让我们实现一个很爽快的功能——交换上下行：</li>
</ul>
<p><code>ddp</code>,就这么简单，即实现了快速交换光标所在行与它下面的行</p>
<h3 id="替换和撤销操作"><a href="#替换和撤销操作" class="headerlink" title="替换和撤销操作"></a>替换和撤销操作</h3><p><code>r+&lt;待替换字母&gt;</code>  将游标所在字母替换为指定字母<br><code>R</code>   连续替换，直到按下<code>Esc</code><br><code>u{n}</code>   撤销一次或n次操作<br><code>U(大写)</code>   撤销当前行的所有修改<br><code>Ctrl+r</code>  redo，即撤销undo的操作</p>
<h3 id="快速缩进"><a href="#快速缩进" class="headerlink" title="快速缩进"></a>快速缩进</h3><p>普通模式下输入 <code>15G</code>，跳转到15行<br>普通模式下输入 <code>&gt;&gt;</code> 整行将向右缩进（使用，用于格式化代码超爽）<br>普通模式下输入 <code>&lt;&lt;</code> 整行向左回退<br>普通模式下输入 <code>:</code> 进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数</p>
<h3 id="shiftwidth命令"><a href="#shiftwidth命令" class="headerlink" title="shiftwidth命令"></a>shiftwidth命令</h3><p>shiftwidth命令是指上一节<code>&gt;&gt;</code>命令产生的缩进（可以简写成sw）<br>普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数<br>获取目前的设定值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:set shiftwidth?</div></pre></td></tr></table></figure></p>
<p>设置缩进的10个字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:set shiftwidth=10</div></pre></td></tr></table></figure></p>
<h3 id="设置文件为准"><a href="#设置文件为准" class="headerlink" title="设置文件为准"></a>设置文件为准</h3><ul>
<li>命令行模式下输入:ce(center)命令使本行内容居中</li>
<li>命令行模式下输入:ri(right)命令使本行文本靠右</li>
<li>命令行模式下输入:le(left)命令使本行内容靠左<h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2>普通模式下输入<code>/</code> 然后输入查找的值，<code>?</code>的功能相同，/是向下，?是向上<br>进入查找之后，输入<code>n</code>和<code>N</code>可以继续查找<br><code>n</code>表示继续查找，<code>N</code>反向查找<h2 id="常用shell-替换"><a href="#常用shell-替换" class="headerlink" title="常用shell 替换"></a>常用shell 替换</h2><code>：5，55 s/^/&quot; &gt;&gt; final.xml/g</code>     在5到55首 插入      “&gt;&gt; final.xml<br><code>：5，55 s/$/&quot; &gt;&gt; final.xml/g</code>    在5到55末 插入      “&gt;&gt; final.xml<br><code>：5，55 s/pengke/zhang/g&quot;</code>    在5到55末pegnke替换成zhang<br><code>:20, s/pengke/PENGKE/g</code>   在20到末尾 pengke替换成PENGKE<br><code>:,15 s/pengke/PENGKE/g</code>   在1到15 pengke替换成PENGKE<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2>多文件编辑<br>可视化模式<br>视窗操作<br>文档加密<br>在vim中执行外部命令<br>vim功能设置<br>实验楼地址：<br><a href="https://www.shiyanlou.com/courses/2/labs/19/document" target="_blank" rel="external">https://www.shiyanlou.com/courses/2/labs/19/document</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/14/auto-zabbix-agentd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/14/auto-zabbix-agentd/" itemprop="url">
                  auto_zabbix_agentd
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-14T11:34:51+08:00">
                2017-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="zabbix通过导入文件的方式批量添加监控"><a href="#zabbix通过导入文件的方式批量添加监控" class="headerlink" title="zabbix通过导入文件的方式批量添加监控"></a>zabbix通过导入文件的方式批量添加监控</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>由于zabbix监控系统的自动发现主机，不是很适合物联网的业务环境。每次也需要自己手动添加监控，更改主机名字。和nagios监控的工作量差不多。所以时间shell脚步完成批量主机的导入。</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>首先观察原来zabbix服务器导出的xml 标准文件</li>
<li>发现，在hosts里面几个重要信息。包括（主机，主机ip，主机名字）</li>
<li>然后我用for循环，使用数据重定向。写入这些信息即可。<br>最后，改脚本方法很笨，可能在大佬们看来不值一提。不过我认为：能完成自己的功能就行。</li>
</ul>
<h3 id="核心知识"><a href="#核心知识" class="headerlink" title="核心知识"></a>核心知识</h3><p>shell的for循环:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a=10</div><div class="line">for ((i=0;i&lt;=$a;i++))</div><div class="line">do</div><div class="line">echo "Test text."</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>vi编辑器添加和插入字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">:5,15 s/^/#/g     # 在5到15行首插入#注释符号</div><div class="line">:5,15 s/$/ .sh/g  # 在5到15行末插入.sh</div></pre></td></tr></table></figure></p>
<p>awk 中的print用$i代替$1 $2 等<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a=10</div><div class="line">test="1 2 3 4 5 6 7 8 9 10 11"</div><div class="line">for ((i=1,i&lt;=$a,i++))</div><div class="line">do</div><div class="line">echo $test | awk '&#123;print i&#125;i="$i"'</div><div class="line"><span class="meta">#</span><span class="bash"> awk 就是在使用外部变量前，需要定义</span></div><div class="line">done</div></pre></td></tr></table></figure></p>
<h3 id="zabbix-监控源代码"><a href="#zabbix-监控源代码" class="headerlink" title="zabbix 监控源代码"></a>zabbix 监控源代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></div><div class="line">head -n 10 zbx_export_hosts.xml &gt; final.xml</div><div class="line">hosts=`cat hosts`</div><div class="line">all=`echo $hosts | awk '&#123;print NF&#125;'`</div><div class="line">if [ ! -n "$1" ];then</div><div class="line">    name='no-name'</div><div class="line">else</div><div class="line">    name=$1</div><div class="line">fi</div><div class="line">for (( i=1;i&lt;=$all;i++))</div><div class="line">do</div><div class="line">    echo "        &lt;host&gt;" &gt;&gt; final.xml</div><div class="line">    a=`echo $hosts | awk '&#123;print $i&#125;' i="$i" `</div><div class="line">    echo "            &lt;host&gt;$a&lt;/host&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;name&gt;$name-$a&lt;/name&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;description/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;proxy/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;status&gt;0&lt;/status&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;ipmi_authtype&gt;-1&lt;/ipmi_authtype&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;ipmi_privilege&gt;2&lt;/ipmi_privilege&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;ipmi_username/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;ipmi_password/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_connect&gt;1&lt;/tls_connect&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_accept&gt;1&lt;/tls_accept&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_issuer/&gt; " &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_subject/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_psk_identity/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;tls_psk/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;templates&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;template&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;name&gt;Linux-Templates&lt;/name&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;/template&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;/templates&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;groups&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;group&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;name&gt;Linux servers&lt;/name&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;/group&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;/groups&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;interfaces&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;interface&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;default&gt;1&lt;/default&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;type&gt;1&lt;/type&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;useip&gt;1&lt;/useip&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;ip&gt;$a&lt;/ip&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;dns/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;port&gt;10050&lt;/port&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;bulk&gt;1&lt;/bulk&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                    &lt;interface_ref&gt;if1&lt;/interface_ref&gt;" &gt;&gt; final.xml</div><div class="line">    echo "                &lt;/interface&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;/interfaces&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;applications/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;items/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;discovery_rules/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;macros/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "            &lt;inventory/&gt;" &gt;&gt; final.xml</div><div class="line">    echo "        &lt;/host&gt;" &gt;&gt; final.xml</div><div class="line">done</div><div class="line"></div><div class="line">tail -n 2 zbx_export_hosts.xml &gt;&gt; final.xml</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>现在初学python，忘记了很多shell的知识。这点需要加强。<br>同事用python 2.7 完成该功能的代码：值得学习：<br><a href="http://blog.hhzzer.com/2017/08/14/python%E5%88%9B%E5%BB%BAzabbix%E4%B8%BB%E6%9C%BA%E5%AF%BC%E5%85%A5xml%E4%BF%A1%E6%81%AF/" target="_blank" rel="external">http://blog.hhzzer.com/2017/08/14/python%E5%88%9B%E5%BB%BAzabbix%E4%B8%BB%E6%9C%BA%E5%AF%BC%E5%85%A5xml%E4%BF%A1%E6%81%AF/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/10/python-12306/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/10/python-12306/" itemprop="url">
                  python_12306
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-10T10:58:31+08:00">
                2017-08-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用pyrhon3爬12306火车余票"><a href="#使用pyrhon3爬12306火车余票" class="headerlink" title="使用pyrhon3爬12306火车余票"></a>使用pyrhon3爬12306火车余票</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul>
<li>初学python2，看完了简明的python教程，是一本很好的书。然后找项目练手，准备了爬虫</li>
<li>看到了实验楼的12306余票查询的教程，就跟根据文档一步一步做。</li>
<li>在最后的阶段，由于实验楼教程过久。12306网站get到数据已经改变。网上找其他教程<br>链接：</li>
</ul>
<ol>
<li>实验楼：<a href="https://www.shiyanlou.com/courses/623/labs/2072/document" target="_blank" rel="external">https://www.shiyanlou.com/courses/623/labs/2072/document</a></li>
<li>参考的网上最新爬虫：<a href="http://blog.csdn.net/lexyhp/article/details/71108216" target="_blank" rel="external">http://blog.csdn.net/lexyhp/article/details/71108216</a> 里面还有使用的很多库的解释和源代码<h2 id="所用到-的库："><a href="#所用到-的库：" class="headerlink" title="所用到 的库："></a>所用到 的库：</h2></li>
<li>requests， 用于请求12306网站网址</li>
<li>docopt， 解析命令行参数</li>
<li>prettytable， 数据用表格的形式打印在终端</li>
<li>colorama， 为打印在表格中的数据着色<h2 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h2>其中步骤，在实验楼的文档里面非常详细。下来说说我自己的步骤。<h3 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h3>首先，你需要做什么？<br>此次目的是为了熟悉python代码。熟悉爬虫的流程。<h3 id="步骤详情："><a href="#步骤详情：" class="headerlink" title="步骤详情："></a>步骤详情：</h3><a href="https://www.shiyanlou.com/courses/623/labs/2072/document" target="_blank" rel="external">https://www.shiyanlou.com/courses/623/labs/2072/document</a></li>
</ol>
<h2 id="我的源代码："><a href="#我的源代码：" class="headerlink" title="我的源代码："></a>我的源代码：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="string">"""命令行火车票查看器</span></div><div class="line"></div><div class="line">Usage:</div><div class="line">    tickets [-gdtkz] &lt;from&gt; &lt;to&gt; &lt;date&gt;</div><div class="line"></div><div class="line">Options:</div><div class="line">    -h,--help   显示帮助菜单</div><div class="line">    -g          高铁</div><div class="line">    -d          动车</div><div class="line">    -t          特快</div><div class="line">    -k          快速</div><div class="line">    -z          直达</div><div class="line"></div><div class="line">Example:</div><div class="line">    tickets 北京 上海 2016-10-10</div><div class="line">    tickets -dg 成都 南京 2016-10-10</div><div class="line">"""</div><div class="line"><span class="keyword">from</span> docopt <span class="keyword">import</span> docopt</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">from</span> stations <span class="keyword">import</span> stations</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</div><div class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init,Fore</div><div class="line"></div><div class="line">init()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrainsCollection</span>:</span></div><div class="line"></div><div class="line">    header = <span class="string">'车次 车站 时间 历时 一等 二等 高级软卧 软卧 硬卧 硬座 无座'</span>.split()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, available_trains,available_place,options)</span>:</span></div><div class="line">        <span class="string">"""查询到的火车班次集合</span></div><div class="line"></div><div class="line">        :param available_trains: 一个列表, 包含可获得的火车班次, 每个</div><div class="line">                                 火车班次是一个字典</div><div class="line">        :param options: 查询的选项, 如高铁, 动车, etc...</div><div class="line">        """</div><div class="line">        self.available_trains = available_trains</div><div class="line">        self.available_place = available_place</div><div class="line">        self.options = options</div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">trains</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">for</span> raw_train <span class="keyword">in</span> self.available_trains:</div><div class="line">            raw_train_list = raw_train.split(<span class="string">'|'</span>)</div><div class="line">            <span class="comment">#print(raw_train_list)</span></div><div class="line">            train_no = raw_train_list[<span class="number">3</span>]</div><div class="line">            <span class="comment">#print(train_no)</span></div><div class="line">            initial = train_no[<span class="number">0</span>].lower()</div><div class="line">            <span class="comment">#print(initial)</span></div><div class="line">            duration = raw_train_list[<span class="number">10</span>]</div><div class="line">            <span class="keyword">if</span>  (initial <span class="keyword">in</span> self.options) <span class="keyword">or</span> (self.options == <span class="string">""</span>) :</div><div class="line">            <span class="comment">#后面这个 or 条件是我自己添加，因为如果不输入参数[-dktz]，就查不出来</span></div><div class="line">                train = [</div><div class="line">                    train_no,        </div><div class="line">                    <span class="string">'\n'</span>.join([Fore.LIGHTGREEN_EX + self.available_place[raw_train_list[<span class="number">6</span>]] + Fore.RESET,</div><div class="line">                               Fore.LIGHTRED_EX + self.available_place[raw_train_list[<span class="number">7</span>]] + Fore.RESET]),</div><div class="line">                    <span class="string">'\n'</span>.join([Fore.LIGHTGREEN_EX + raw_train_list[<span class="number">8</span>] + Fore.RESET,</div><div class="line">                               Fore.LIGHTRED_EX + raw_train_list[<span class="number">9</span>] + Fore.RESET]),</div><div class="line">                    duration,</div><div class="line">                    raw_train_list[<span class="number">-4</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-4</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-5</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-5</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-14</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-14</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-12</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-12</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-7</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-7</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-6</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-6</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                    raw_train_list[<span class="number">-9</span>] <span class="keyword">if</span> raw_train_list[<span class="number">-9</span>] <span class="keyword">else</span> <span class="string">'--'</span>,</div><div class="line">                ]</div><div class="line">                <span class="comment">#print(train[:])</span></div><div class="line">                <span class="keyword">yield</span> train</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pretty_print</span><span class="params">(self)</span>:</span></div><div class="line">        pt = PrettyTable()</div><div class="line">        pt._set_field_names(self.header)</div><div class="line">        <span class="keyword">for</span> train <span class="keyword">in</span> self.trains:</div><div class="line">            pt.add_row(train)</div><div class="line">        print(pt)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""command-line interface"""</span></div><div class="line">    arguments = docopt(__doc__) <span class="comment">#__doc__是出去当前对象的帮助文档</span></div><div class="line">    <span class="comment">#   print(arguments)#是返回一个字典</span></div><div class="line">    from_station = stations.get(arguments[<span class="string">'&lt;from&gt;'</span>])</div><div class="line">    to_station = stations.get(arguments[<span class="string">'&lt;to&gt;'</span>])</div><div class="line">    date = arguments[<span class="string">'&lt;date&gt;'</span>]</div><div class="line">    url = <span class="string">'https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=&#123;&#125;&amp;leftTicketDTO.from_station=&#123;&#125;&amp;leftTicketDTO.to_station=&#123;&#125;&amp;purpose_codes=ADULT'</span>.format(date, from_station, to_station)</div><div class="line">    options= <span class="string">''</span>.join([key <span class="keyword">for</span> key, value <span class="keyword">in</span> arguments.items() <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">True</span>])</div><div class="line">    <span class="comment"># 获取参数</span></div><div class="line">    <span class="comment"># 添加verify=False 参数不验证证书</span></div><div class="line">    r=requests.get(url, verify=<span class="keyword">False</span>)</div><div class="line">    <span class="comment">#print(r.json())</span></div><div class="line">    <span class="comment">#r = requests.get(url);</span></div><div class="line">    available_trains = r.json()[<span class="string">'data'</span>][<span class="string">'result'</span>]</div><div class="line">    available_place = r.json()[<span class="string">'data'</span>][<span class="string">'map'</span>]</div><div class="line">    <span class="comment">#print(available_trains[:])</span></div><div class="line">    <span class="comment">#a=''.join(available_trains[:])</span></div><div class="line">    <span class="comment">#print(a.split("|"))</span></div><div class="line">    <span class="comment">#Trainsconllection(available_trains, options).pretty_print()</span></div><div class="line">    TrainsCollection(available_trains,available_place,options).pretty_print()</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    cli()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/26/sublime-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/26/sublime-install/" itemprop="url">
                  sublime_install
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-26T10:42:34+08:00">
                2017-07-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近学习python，使用sublime text3 编辑器。真的很方便和好用.可以安装很多插件，来选择自己想要的编译系统<br><strong>注意：</strong>最好不要在百度下破解版，不然安装<code>Package Control</code>组件各种问题。</p>
<h2 id="安装subleme-text3"><a href="#安装subleme-text3" class="headerlink" title="安装subleme text3"></a>安装subleme text3</h2><p>在官网下载，直接安装。</p>
<h2 id="配置sublime的插件"><a href="#配置sublime的插件" class="headerlink" title="配置sublime的插件"></a>配置sublime的插件</h2><p>配置插件我们使用<code>Package Control</code>工具。非常方便自动安装和管理，设置插件。<br>以下是安装步骤：</p>
<h3 id="自动安装Package-Control工具或者手动安装"><a href="#自动安装Package-Control工具或者手动安装" class="headerlink" title="自动安装Package Control工具或者手动安装"></a>自动安装Package Control工具或者手动安装</h3><p>自动安装：<br>官网有详细教程：<a href="https://packagecontrol.io/installation" target="_blank" rel="external">https://packagecontrol.io/installation</a></p>
<ol>
<li>打开sublime 使用<code>ctrl+\``或者</code>View &gt; Show Console`</li>
<li>输入以下代码：完成自动安装。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import urllib.request,os,hashlib; h = &apos;df21e130d211cfc94d9b0905775a7c0f&apos; + &apos;1e3d39e33b79698005270310898eea76&apos;; pf = &apos;Package Control.sublime-package&apos;; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( &apos;http://packagecontrol.io/&apos; + pf.replace(&apos; &apos;, &apos;%20&apos;)).read(); dh = hashlib.sha256(by).hexdigest(); print(&apos;Error validating download (got %s instead of %s), please try manual install&apos; % (dh, h)) if dh != h else open(os.path.join( ipp, pf), &apos;wb&apos; ).write(by)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果自动安装失败，需要手动安装。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1. Click the Preferences &gt; Browse Packages… menu </div><div class="line">2. Browse up a folder and then into the Installed Packages/ folder </div><div class="line">3. Download Package Control.sublime-package and copy it into the Installed Packages/ directory </div><div class="line">4. Restart Sublime Text</div></pre></td></tr></table></figure></p>
<h2 id="通过Package-Control工具安装插件"><a href="#通过Package-Control工具安装插件" class="headerlink" title="通过Package Control工具安装插件"></a>通过Package Control工具安装插件</h2><p>我一共安装了几个插件，网上说写python非常有用。插件如下：</p>
<ul>
<li>anaconda 这个是代码提示，idte等很强大的工具</li>
<li>package control  这个是管理工具</li>
<li>sidebarenhancements 这个可以新建文件</li>
<li>sublimecodelntel   这个是代码自动提示</li>
<li>sublimerepl  这个是sublime的主题是</li>
<li>sublimetmpl 这个是新建文件模板<h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3></li>
</ul>
<ol>
<li>按下Ctrl+Shift+P调出命令面板</li>
<li>输入install 调出 Install Package 选项并回车，然后在列表中选中要安装的插件。<br>直接搜索需要安装的插件点击即可。<br>或者：<br><code>preferences-&gt;package control-&gt;install package</code><br>其中<br>卸载，查看，设置插件都可以在这里面看到。<h2 id="配置anaconda插件"><a href="#配置anaconda插件" class="headerlink" title="配置anaconda插件"></a>配置anaconda插件</h2>由于，安装这个插件后，非常多的警告出现，我们需要关掉这些。</li>
<li>在菜单中Preferences &gt;&gt; Package Settings中打开Anaconda的user settings配置文件。</li>
<li>在上述配置文件中加入以下内容，并保存。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123; </div><div class="line">	&quot;anaconda_linting&quot;: false, </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="配置sublimerepl插件，就是python的idte"><a href="#配置sublimerepl插件，就是python的idte" class="headerlink" title="配置sublimerepl插件，就是python的idte"></a>配置sublimerepl插件，就是python的idte</h2><h2 id="可以使用的license"><a href="#可以使用的license" class="headerlink" title="可以使用的license"></a>可以使用的license</h2><p>不要复制–里面的内容<br>第一个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">—– BEGIN LICENSE —–</div><div class="line">Michael Barnes</div><div class="line">Single User License</div><div class="line">EA7E-821385</div><div class="line">8A353C41 872A0D5C DF9B2950 AFF6F667</div><div class="line">C458EA6D 8EA3C286 98D1D650 131A97AB</div><div class="line">AA919AEC EF20E143 B361B1E7 4C8B7F04</div><div class="line">B085E65E 2F5F5360 8489D422 FB8FC1AA</div><div class="line">93F6323C FD7F7544 3F39C318 D95E6480</div><div class="line">FCCC7561 8A4A1741 68FA4223 ADCEDE07</div><div class="line">200C25BE DBBC4855 C4CFB774 C5EC138C</div><div class="line">0FEC1CEF D9DCECEC D3A5DAD1 01316C36</div><div class="line">—— END LICENSE ——</div></pre></td></tr></table></figure></p>
<p>第二个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">—– BEGIN LICENSE —–</div><div class="line">Alexey Plutalov</div><div class="line">Single User License</div><div class="line">EA7E-860776</div><div class="line">3DC19CC1 134CDF23 504DC871 2DE5CE55</div><div class="line">585DC8A6 253BB0D9 637C87A2 D8D0BA85</div><div class="line">AAE574AD BA7D6DA9 2B9773F2 324C5DEF</div><div class="line">17830A4E FBCF9D1D 182406E9 F883EA87</div><div class="line">E585BBA1 2538C270 E2E857C2 194283CA</div><div class="line">7234FF9E D0392F93 1D16E021 F1914917</div><div class="line">63909E12 203C0169 3F08FFC8 86D06EA8</div><div class="line">73DDAEF0 AC559F30 A6A67947 B60104C6</div><div class="line">—— END LICENSE ——</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/24/gdisk-分区/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/24/gdisk-分区/" itemprop="url">
                  gdisk_分区
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-24T16:37:38+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在安装系统中，一般来说超过2T的硬盘，就不能使用fdisk分区了。我们常用part分区，<br>由于公司，要求将20T硬盘以逻辑卷形式挂在/data目录下。part分区好像并没有设置<br>系统分区为格式 lvm 格式。所以需要 gdisk 分区。gdisk就是（GPT格式的disk）</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>配置之前，可以使用<code>fdisk -l</code> 查看，是那一块盘哦<br>详细信息如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">mkdir /data</div><div class="line"></div><div class="line">gdisk /dev/sdk</div><div class="line"></div><div class="line">Command (? for help): ?</div><div class="line">b       back up GPT data to a file</div><div class="line">c       change a partition's name</div><div class="line">d       delete a partition</div><div class="line">i       show detailed information on a partition</div><div class="line">l       list known partition types</div><div class="line">n       add a new partition</div><div class="line">o       create a new empty GUID partition table (GPT)</div><div class="line">p       print the partition table</div><div class="line">q       quit without saving changes</div><div class="line">r       recovery and transformation options (experts only)</div><div class="line">s       sort partitions</div><div class="line">t       change a partition's type code</div><div class="line">v       verify disk</div><div class="line">w       write table to disk and exit</div><div class="line">x       extra functionality (experts only)</div><div class="line">?       print this menu</div><div class="line"></div><div class="line">Command (? for help): </div><div class="line"></div><div class="line"></div><div class="line">Command (? for help): n</div><div class="line">Partition number (1-128, default 1): </div><div class="line">First sector (34-40957358046, default = 2048) or &#123;+-&#125;size&#123;KMGTP&#125;: </div><div class="line">Last sector (2048-40957358046, default = 40957358046) or &#123;+-&#125;size&#123;KMGTP&#125;: </div><div class="line">Current type is 'Linux filesystem'</div><div class="line">Hex code or GUID (L to show codes, Enter = 8300): 8e00</div><div class="line">Changed type of partition to 'Linux LVM'</div><div class="line"></div><div class="line">Command (? for help): p</div><div class="line">Disk /dev/sdk: 40957358080 sectors, 19.1 TiB</div><div class="line">Logical sector size: 512 bytes</div><div class="line">Disk identifier (GUID): F8C461D2-634A-4A57-B6CF-977F2A0E86BF</div><div class="line">Partition table holds up to 128 entries</div><div class="line">First usable sector is 34, last usable sector is 40957358046</div><div class="line">Partitions will be aligned on 2048-sector boundaries</div><div class="line">Total free space is 2014 sectors (1007.0 KiB)</div><div class="line"></div><div class="line">Number  Start (sector)    End (sector)  Size       Code  Name</div><div class="line">   1            2048     40957358046   19.1 TiB    8E00  Linux LVM</div><div class="line"></div><div class="line">wq</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong> 其中我们默认是使用全部分在一个分区，所有一直按确认即可。<br>帮助：<code>？</code>   <code>n</code> 是添加分区， <code>l</code>是查看分区格式类型。和fdisk不一样，这里的8e00 在fdisk是8e  <code>t</code>是改变分区系统格式<br>最后<code>wq</code> 退出即可。  最候使用 <code>fdisk -l</code>  看看我们的分区详情。</p>
<p>然后分区，加入 lvm  其中lvcreat有新命令哦<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pvcreate /dev/sdk1</div><div class="line">vgextend rhel /dev/sdk1</div><div class="line">vgdisplay </div><div class="line">lvcreate -n data -l 100%FREE rhel</div><div class="line">mkfs.xfs /dev/mapper/rhel-data </div><div class="line">vi /etc/fstab </div><div class="line">/dev/mapper/rhel-data   /data                   xfs     defaults        0 0</div><div class="line">mount -a</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong> lvcreat 命令是使用vg里面的空间，我们扩展或者新建时候，在选择大小时候，有两种方式<br>PE和SIZE：<code>vgdisplay</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]# vgdisplay </div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               rhel</div><div class="line">  System ID             </div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        2</div><div class="line">  Metadata Sequence No  6</div><div class="line">  VG Access             read/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                4</div><div class="line">  Open LV               4</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                2</div><div class="line">  Act PV                2</div><div class="line">  VG Size               19.98 TiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              5237883</div><div class="line">  Alloc PE / Size       5237883 / 19.98 TiB</div><div class="line">  Free  PE / Size       0 / 0 </div><div class="line"><span class="meta">  #</span><span class="bash">这里使用：PE模式命令：lvcreate -n data -l 100%FREE rhel</span></div><div class="line">  VG UUID               qt7tUm-NoXx-e1GP-QnCf-Ibrd-1s5f-kmQ0JM</div><div class="line">   </div><div class="line">[root@localhost src]#</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong> 其中讲道理是lvextend也可以用这种方式。现在总结2中方法：</p>
<h3 id="lvcreat"><a href="#lvcreat" class="headerlink" title="lvcreat"></a>lvcreat</h3><p><code>lvcreate -n data -l 100%FREE rhel</code> 将vg中所有空间拿来使用（PE）<br><code>lvcreate -n data -L 100G rhel</code> 将vg里面100G给lv data使用</p>
<h3 id="lvextend"><a href="#lvextend" class="headerlink" title="lvextend"></a>lvextend</h3><p><code>lvextend -L +100M /dev/mapper/rhel-data</code>    将vg里面100G给lv data使用</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/19/ansible学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/19/ansible学习/" itemprop="url">
                  ansible学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-19T11:58:03+08:00">
                2017-07-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><h3 id="1-1-centos-7-系列-系统安装"><a href="#1-1-centos-7-系列-系统安装" class="headerlink" title="1.1 centos 7 系列 系统安装"></a>1.1 centos 7 系列 系统安装</h3><p>前提，尽量使用yum安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum install epel-release</div><div class="line">yum install ansible -y</div><div class="line">yum install python-pip</div><div class="line">pip install ansible</div><div class="line">pip install --upgrade setuptools</div></pre></td></tr></table></figure></p>
<h3 id="1-2-ubuntu-系统"><a href="#1-2-ubuntu-系统" class="headerlink" title="1.2 ubuntu 系统"></a>1.2 ubuntu 系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-add-repository -y ppa:ansible/ansible</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install -y ansible</div></pre></td></tr></table></figure>
<h3 id="1-3-安装成功后简单配置"><a href="#1-3-安装成功后简单配置" class="headerlink" title="1.3  安装成功后简单配置"></a>1.3  安装成功后简单配置</h3><p>安装成功后，配偶文件在:  /etc/ansible/目录下，其中默认的hosts文件也在里面。<br>安装成功后，默认是用key登录，我们改成密码的方式、就需要在hosts文件添加远程用户名和密码：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[test]</div><div class="line">192.168.13.130</div><div class="line">[test:vars]</div><div class="line">ansible_ssh_user=app</div><div class="line">ansible_ssh_pass=app_!QAZxsw2</div></pre></td></tr></table></figure></p>
<p>测试代码: <code>ansible all -a &quot;/bin/echo hello&quot;</code><br>若使用ssh-key登陆，配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ssh-agent bash</div><div class="line">$ ssh-add ~/.ssh/id_rsa</div></pre></td></tr></table></figure></p>
<p>如果不想使用 ssh-agent, 想通过密码验证的方式使用 SSH,<br>可以在执行ansible命令时使用 <code>-k</code> 参数选项, 但这里建议使用 ssh-agent.</p>
<h2 id="2-简单使用"><a href="#2-简单使用" class="headerlink" title="2. 简单使用"></a>2. 简单使用</h2><p>官方文档：<a href="http://www.ansible.com.cn/docs/intro_inventory.html" target="_blank" rel="external">http://www.ansible.com.cn/docs/intro_inventory.html</a></p>
<h3 id="2-1-Inventory文件"><a href="#2-1-Inventory文件" class="headerlink" title="2.1 Inventory文件"></a>2.1 Inventory文件</h3><p>Inventory文件 ： 就是主机清单。里面记录着主机组中的多台主机。 已经变量。默认在<code>/etc/ansible/hosts</code>中。<br>例子:  hosts文件内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">10.10.10.10:2222 #若不是默认的22端口</div><div class="line">[webservers]  #主机组名</div><div class="line">foo.example.com</div><div class="line">bar.example.com</div><div class="line"></div><div class="line">[dbservers]   #主机组名</div><div class="line">one.example.com</div><div class="line">two.example.com</div><div class="line">three.example.com</div><div class="line"></div><div class="line">[test]   #主机组名</div><div class="line">192.168.13.130</div><div class="line">[test:vars]    #主机组里面的变量</div><div class="line">ansible_ssh_user=app</div><div class="line">ansible_ssh_pass=app_!QAZxsw2</div></pre></td></tr></table></figure></p>
<p>将变量定义在，其他文件中，host文件包含定义变量的文件<br>参考链接：<a href="http://www.ansible.com.cn/docs/intro_inventory.html" target="_blank" rel="external">http://www.ansible.com.cn/docs/intro_inventory.html</a></p>
<h3 id="2-2-支持主机组里面的变量如下："><a href="#2-2-支持主机组里面的变量如下：" class="headerlink" title="2.2 支持主机组里面的变量如下："></a>2.2 支持主机组里面的变量如下：</h3><p>inventory文件的参数（组变量）如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">ansible_ssh_host</div><div class="line">      #将要连接的远程主机名.与你想要设定的主机的别名不同的话,可通过此变量设置.</div><div class="line"></div><div class="line">ansible_ssh_port</div><div class="line">      #ssh端口号.如果不是默认的端口号,通过此变量设置.</div><div class="line"></div><div class="line">ansible_ssh_user</div><div class="line">      #默认的 ssh 用户名</div><div class="line"></div><div class="line">ansible_ssh_pass</div><div class="line">      #ssh 密码(这种方式并不安全,我们强烈建议使用 --ask-pass 或 SSH 密钥)</div><div class="line"></div><div class="line">ansible_sudo_pass</div><div class="line">      #sudo 密码(这种方式并不安全,我们强烈建议使用 --ask-sudo-pass)</div><div class="line"></div><div class="line">ansible_sudo_exe (new in version 1.8)</div><div class="line">      #sudo 命令路径(适用于1.8及以上版本)</div><div class="line"></div><div class="line">ansible_connection</div><div class="line">      #与主机的连接类型.比如:local, ssh 或者 paramiko. Ansible 1.2 以前默认使用</div><div class="line">      # paramiko.1.2 以后默认使用 &apos;smart&apos;,&apos;smart&apos; 方式会根据是否</div><div class="line">      #支持ControlPersist, 来判断&apos;ssh&apos; 方式是否可行.</div><div class="line"></div><div class="line">ansible_ssh_private_key_file</div><div class="line">      #ssh 使用的私钥文件.适用于有多个密钥,而你不想使用 SSH 代理的情况.</div><div class="line"></div><div class="line">ansible_shell_type</div><div class="line">      #目标系统的shell类型.默认情况下,命令的执行使用 &apos;sh&apos; 语法,</div><div class="line">      #可设置为 &apos;csh&apos; 或 &apos;fish&apos;.</div><div class="line"></div><div class="line">ansible_python_interpreter</div><div class="line">      #目标主机的 python 路径.适用于的情况: 系统中有多个 Python, </div><div class="line">      #或者命令路径不是&quot;/usr/bin/python&quot;,比如  \*BSD, 或者 /usr/bin/python</div><div class="line">      #不是 2.X 版本的 Python.我们不使用 &quot;/usr/bin/env&quot; 机制,</div><div class="line">      #因为这要求远程用户的路径设置正确,且要求 &quot;python&quot; 可执行程序名不可</div><div class="line">      #为 python以外的名字(实际有可能名为python26).</div><div class="line">      #与 ansible_python_interpreter 的工作方式相同,</div><div class="line">      #可设定如 ruby 或 perl 的路径....</div></pre></td></tr></table></figure></p>
<p>以上是静态的inventory 文件，也可以是inventory 动态文件，保存在数据库中等<br>例如： 配置管理数据库工具：  ansible-cmdb  这个很重要，可以通过web方式，显示出来<br>参考链接：<a href="http://www.ansible.com.cn/docs/intro_dynamic_inventory.html" target="_blank" rel="external">http://www.ansible.com.cn/docs/intro_dynamic_inventory.html</a><br>参考链接：<a href="http://www.ansible.com.cn/docs/developing_inventory.html" target="_blank" rel="external">http://www.ansible.com.cn/docs/developing_inventory.html</a></p>
<h3 id="2-3-patterns-（模式）"><a href="#2-3-patterns-（模式）" class="headerlink" title="2.3 patterns  （模式）"></a>2.3 patterns  （模式）</h3><p>它就是 不用playbooks，直接用ansible执行一系列命令<br>在Ansible中,Patterns 是指我们怎样确定由哪一台主机来管理. 意思就是与哪台主机进行交互.<br>但是在:doc:playbooks 中它指的是对应主机应用特定的配置或执行特定进程.<br>例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ansible webservers -m service -a "name=httpd state=restarted"`</div><div class="line"><span class="meta">#</span>若多个组： 用冒号隔开，表示或， 表示在一个组，不在另一个组用：</div><div class="line">ansible webservers:test -m service -a "name=httpd state=restarted"</div><div class="line">ansible webservers:!test -m service -a "name=httpd state=restarted"</div><div class="line">ansible webservers:&amp;test -m service -a "name=httpd state=restarted"   #两个组的交集</div></pre></td></tr></table></figure></p>
<p>它分为两类：一个是ansilbel（Ad-Hoc） 和 playbooks（ymal文件）</p>
<h3 id="2-4-Introduction-To-Ad-Hoc-Commands"><a href="#2-4-Introduction-To-Ad-Hoc-Commands" class="headerlink" title="2.4  Introduction To Ad-Hoc Commands"></a>2.4  Introduction To Ad-Hoc Commands</h3><p>所谓 ad-hoc 命令是什么呢?</p>
<ol>
<li>这其实是一个概念性的名字,是相对于写 Ansible playbook来说的.类似于在命令行敲入shell命令和 写shell scripts两者之间的关系)…</li>
<li>如果我们敲入一些命令去比较快的完成一些事情,而不需要将这些执行的命令特别保存下来, 这样的命令就叫做 ad-hoc 命令.</li>
<li>Ansible提供两种方式去完成任务,一是 ad-hoc 命令,一是写 Ansible playbook.前者可以解决一些简单的任务, 后者解决较复杂的任务.</li>
<li>那我们会在什么情境下去使用ad-hoc 命令呢?比如说因为圣诞节要来了,想要把所有实验室的电源关闭,我们只需要执行一行命令 就可以达成这个任务,而不需要写 playbook 来做这个任务.</li>
<li><p>至于说做配置管理或部署这种事,还是要借助 playbook 来完成,<br>即使用 ‘/usr/bin/ansible-playbook’ 这个命令.</p>
<p> 比如我重启某组的主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible atlanta -a &quot;/usr/bin/foo&quot; -u username -f 10  #-f是进程数，-u后面是以某用户身份执行</div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果想通过 sudo 去执行命令,如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible atlanta -a &quot;/usr/bin/foo&quot; -u username --sudo [--ask-sudo-pass]</div></pre></td></tr></table></figure></p>
<p>使用sudo，前提 你的-u 后面用户有sudo权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible atlanta -a &quot;/usr/bin/foo&quot; -u username -b -K</div></pre></td></tr></table></figure></p>
<p>2.5 常用模块介绍<br>常用模块：  </p>
<ul>
<li>第一： service command shell   就是执行一些linux shell 基本命令</li>
<li>第二： copy 用于文件的传输：<code>ansible atlanta -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;</code></li>
<li>第三：file 。使用 file 模块可以做到修改文件的属主和权限,(在这里可替换为 copy 模块,是等效的):<br><code>nsible webservers -m file -a &quot;dest=/srv/foo/a.txt mode=600&quot;</code><br><code>ansible webservers -m file -a &quot;dest=/srv/foo/b.txt mode=600 owner=mdehaangroup=mdehaan&quot;</code><br>删除目录(递归的删除)和删除文件:<br><code>ansible webservers -m file -a &quot;dest=/path/to/c state=absent&quot;</code></li>
<li>第四：yum。Ansible 提供对 yum 和 apt 的支持.这里是关于 yum 的示例.<br>确认一个软件包已经安装,但不去升级它:<br><code>$ ansible webservers -m yum -a &quot;name=acme state=present&quot;</code><br>确认一个软件包的安装版本:<br><code>$ ansible webservers -m yum -a &quot;name=acme-1.5 state=present&quot;</code><br>确认一个软件包还没有安装:<br><code>$ ansible webservers -m yum -a &quot;name=acme state=absent&quot;</code><br>对于不同平台的软件包管理工具,Ansible都有对应的模块.如果没有,你也可以使用<br>command 模块去安装软件. 或者最好是来为那个软件包管理工具贡献一个相应的模块.<br>请在 mailing list 中查看相关的信息和详情.</li>
<li><p>第四： Users and Groups    –模块<br>使用 ‘user’ 模块可以方便的创建账户,删除账户,或是管理现有的账户:<br><code>$ ansible all -m user -a &quot;name=foo password=&lt;crypted password here&gt;&quot;</code><br><code>$ ansible all -m user -a &quot;name=foo state=absent&quot;</code></p>
</li>
<li><p>第五： Managing Services<br>确认某个服务在所有的webservers上都已经启动:<br><code>$ ansible webservers -m service -a &quot;name=httpd state=started&quot;</code><br>或是在所有的webservers上重启某个服务(译者注:可能是确认已重启的状态?):<br><code>$ ansible webservers -m service -a &quot;name=httpd state=restarted&quot;</code><br>确认某个服务已经停止:<br><code>$ ansible webservers -m service -a &quot;name=httpd state=stopped&quot;</code></p>
<h2 id="3-ansible的配置文件"><a href="#3-ansible的配置文件" class="headerlink" title="3. ansible的配置文件"></a>3. ansible的配置文件</h2><h3 id="3-1-ansible读取配置文件的顺序："><a href="#3-1-ansible读取配置文件的顺序：" class="headerlink" title="3.1 ansible读取配置文件的顺序："></a>3.1 ansible读取配置文件的顺序：</h3></li>
<li><ul>
<li>ANSIBLE_CONFIG (一个环境变量)</li>
</ul>
</li>
<li><ul>
<li>ansible.cfg (位于当前目录中)</li>
</ul>
</li>
<li><ul>
<li>.ansible.cfg (位于家目录中)</li>
</ul>
</li>
<li><ul>
<li>/etc/ansible/ansible.cfg<br>Ansible 将会按以上顺序逐个查询这些文件,直到找到一个为止,并且使用第一个寻找到个配置文件的配置,这些配置将不会被叠加.<br>配置文件的详细参数以及取值范围请查看<code>ansible.cfg</code><br>参考链接：<a href="https://raw.github.com/ansible/ansible/devel/examples/ansible.cfg" target="_blank" rel="external">https://raw.github.com/ansible/ansible/devel/examples/ansible.cfg</a></li>
</ul>
</li>
</ul>
<h3 id="3-2-配置文件详情："><a href="#3-2-配置文件详情：" class="headerlink" title="3.2 配置文件详情："></a>3.2 配置文件详情：</h3><p>默认的配置文件基本不用改变，我将日志打开了<br>(注意日志文件的权限。/var目录一般只能root读取，ansible是你远程登陆的用户执行)<br><a href="http://www.ansible.com.cn/docs/intro_configuration.html#ansible-managed" target="_blank" rel="external">http://www.ansible.com.cn/docs/intro_configuration.html#ansible-managed</a></p>
<h2 id="4-windows-支持"><a href="#4-windows-支持" class="headerlink" title="4. windows 支持"></a>4. windows 支持</h2><p>Ansible仍然通过一台Linux系统机器来进行集中管理,使用Python的 “winrm” 模块来和远程主机交互.<br>建议先学习playbooks<br><a href="https://github.com/ansible/ansible-examples" target="_blank" rel="external">https://github.com/ansible/ansible-examples</a>   一些例子</p>
<h2 id="5-playbook学习"><a href="#5-playbook学习" class="headerlink" title="5. playbook学习"></a>5. playbook学习</h2><p>playbook 由一个或多个 ‘plays’ 计划组成.它的内容是一个以 ‘plays’ 为元素的列表.在 play 之中,一组机器被映射为定义好的角色.在 ansible 中,play 的内容,被称为 tasks,即任务.在基本层次的应用中,一个任务是一个对 ansible 模块的调用。<br>plays 是playbook的一个核心内脏。  一个playbook 执行多个任务，就是多个plays</p>
<p>下面是只有一个plays情况； <code>注意:</code> <strong>一个name下面只能执行一个模块(一个action)</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  vars:</div><div class="line">    http_port: 80</div><div class="line">    max_clients: 200</div><div class="line">  remote_user: root</div><div class="line">  tasks:</div><div class="line">  - name: ensure apache is at the latest version</div><div class="line">    yum: pkg=httpd state=latest</div><div class="line">  - name: write the apache config file</div><div class="line">    template: src=/srv/httpd.j2 dest=/etc/httpd.conf</div><div class="line">    notify:</div><div class="line">    - restart apache</div><div class="line">  - name: ensure apache is running</div><div class="line">    service: name=httpd state=started</div><div class="line">  handlers:</div><div class="line">    - name: restart apache</div><div class="line">      service: name=httpd state=restarted</div></pre></td></tr></table></figure></p>
<p>层次关系：  playbook-&gt;plays-&gt;tast-&gt;name(只能执行一个模块（action）)</p>
<h3 id="5-1-playbook基础"><a href="#5-1-playbook基础" class="headerlink" title="5.1 playbook基础"></a>5.1 playbook基础</h3><p>主机与用户<br>你可以为 playbook 中的每一个 play,个别地选择操作的目标机器是哪些,<br>以哪个用户身份去完成要执行的步骤（called tasks）.<br>hosts 行的内容是一个或多个组或主机的 patterns,以逗号为分隔符,详见 Patterns 章节.<br>remote_user 就是账户名:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div></pre></td></tr></table></figure></p>
<p>再者,在每一个 task 中,可以定义自己的远程用户:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  tasks:</div><div class="line">    - name: test connection</div><div class="line">      ping:</div><div class="line">      remote_user: yourname</div></pre></td></tr></table></figure></p>
<p>也支持从 sudo 执行命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: yourname</div><div class="line">  sudo: yes</div></pre></td></tr></table></figure></p>
<p>同样的,你可以仅在一个 task 中,使用 sudo 执行命令,而不是在整个 play 中使用 sudo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: yourname</div><div class="line">  tasks:</div><div class="line">    - service: name=nginx state=started</div><div class="line">      sudo: yes</div></pre></td></tr></table></figure></p>
<p>你也可以登陆后,sudo 到不同的用户身份,而不是使用 root:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: yourname</div><div class="line">  sudo: yes</div><div class="line">  sudo_user: postgres</div></pre></td></tr></table></figure></p>
<p>如果你需要在使用 sudo 时指定密码,可在运行 ansible-playbook 命令时加上选项 <code>--ask-sudo-pass</code>这个参数 就是等于  (-K). 参数<br>如果使用 sudo 时,playbook 疑似被挂起,可能是在 sudo prompt 处被卡住,这时可执行 <code>Control + C</code>杀死卡住的任务,<br>再重新运行一次.</p>
<h3 id="5-2-Tasks-列表"><a href="#5-2-Tasks-列表" class="headerlink" title="5.2 Tasks 列表"></a>5.2 Tasks 列表</h3><p>每一个 play 包含了一个 task 列表（任务列表）.一个 task 在其所对应的所有主机上（通过 host pattern 匹配的所有主机）执行完毕之后,下一个 task 才会执行.<br>在运行 playbook 时（从上到下执行）,如果一个 host 执行 task 失败,这个 host 将会从整个 playbook 的 rotation 中移除. 意思就是在 ; task中，<strong>一个name 只能执行一个模块shell command等</strong><br>每一个 task 必须有一个名称 name,这样在运行 playbook 时,从其输出的任务执行信息中可以很好的辨别出是属于哪一个 task 的.<br>如果没有定义 name,‘action’ 的值将会用作输出信息中标记特定的 task</p>
<p>test的定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">tasks:</div><div class="line">  - name: make sure apache is running</div><div class="line">    service: name=httpd state=running</div><div class="line"></div><div class="line">tasks:</div><div class="line">  - name: disable selinux</div><div class="line">    command: /sbin/setenforce 0</div><div class="line"></div><div class="line">tasks:</div><div class="line">  - name: run this command and ignore the result </div><div class="line">    shell: /usr/bin/somecommand</div><div class="line">    ignore_errors: True                   #忽略错误</div></pre></td></tr></table></figure></p>
<p>在 action 行中可以使用变量.假设在 ‘vars’ 那里定义了一个变量 ‘vhost’ ,可以这样使用它:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tasks:</div><div class="line">  - name: create a virtual host file for &#123;&#123; vhost &#125;&#125;</div><div class="line">    template: src=somefile.j2 dest=/etc/httpd/conf.d/&#123;&#123; vhost &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>第一次运行playbook，我的第一个playbook，重启xinetd 服务<br>命令：<code>ansible-playbook playbook.yml -i host -K</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: tmp</div><div class="line">  remote_user: app</div><div class="line">  sudo: yes</div><div class="line">  sudo_user: root</div><div class="line">  tasks:</div><div class="line">    - service: name=xinetd state=restarted</div><div class="line">      sudo: yes</div></pre></td></tr></table></figure></p>
<h2 id="6-Playbook-角色-Roles-和-Include-语句"><a href="#6-Playbook-角色-Roles-和-Include-语句" class="headerlink" title="6. Playbook 角色(Roles) 和 Include 语句"></a>6. Playbook 角色(Roles) 和 Include 语句</h2><p>在一个基础的 playbook 中,所有的 task 都是在一个 play 中列出,稍后将介绍一种更合理的安排 task 的方式:使用 ‘include:’ 指令.<br>就是一个任务，tast，需要被多过play 或者 playbook使用，我们可以将任务tast写在文件里面，在play中用include包含它</p>
<h2 id="7-Roles-—-非常重要和方便，什么时候回来学学"><a href="#7-Roles-—-非常重要和方便，什么时候回来学学" class="headerlink" title="7. Roles   —-非常重要和方便，什么时候回来学学"></a>7. Roles   —-非常重要和方便，什么时候回来学学</h2><p>你现在已经学过 tasks 和 handlers，那怎样组织 playbook 才是最好的方式呢？简单的回答就是：<br>使用 roles ! Roles 基于一个已知的文件结构，去自动的加载某些 vars_files，tasks 以及 handlers。<br>基于 roles 对内容进行分组，使得我们可以容易地与其他用户分享 roles 。<br>这使宿主机的动态分组有了匹配的标准,即使该分组尚未在清单文件中被定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"></div><div class="line"># talk to all hosts just so we can learn about them</div><div class="line">- hosts: all</div><div class="line">  tasks:</div><div class="line">     - group_by: key=os_&#123;&#123; ansible_distribution &#125;&#125;</div><div class="line"></div><div class="line"># now just on the CentOS hosts...</div><div class="line"></div><div class="line">- hosts: os_CentOS</div><div class="line">  gather_facts: False</div><div class="line">  tasks:</div><div class="line">     - # tasks that only happen on CentOS go here</div></pre></td></tr></table></figure></p>
<p>这会抛出所有基于操作系统名的分组.<br>如果需要对特定分组做设定,这也是可以的.例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"># file: group_vars/all</div><div class="line">asdf: 10</div><div class="line"></div><div class="line">---</div><div class="line"># file: group_vars/os_CentOS</div><div class="line">asdf: 42</div></pre></td></tr></table></figure></p>
<p>顶层目录结构应当包括下列文件和目录.一个项目的结构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">production                # inventory file for production servers 关于生产环境服务器的清单文件</div><div class="line">stage                     # inventory file for stage environment 关于 stage 环境的清单文件</div><div class="line"></div><div class="line">group_vars/</div><div class="line">   group1                 # here we assign variables to particular groups 这里我们给特定的组赋值</div><div class="line">   group2                 # &quot;&quot;</div><div class="line">host_vars/</div><div class="line">   hostname1              # if systems need specific variables, put them here 如果系统需要特定的变量,把它们放置在这里.</div><div class="line">   hostname2              # &quot;&quot;</div><div class="line"></div><div class="line">library/                  # if any custom modules, put them here (optional) 如果有自定义的模块,放在这里(可选)</div><div class="line">filter_plugins/           # if any custom filter plugins, put them here (optional) 如果有自定义的过滤插件,放在这里(可选)</div><div class="line"></div><div class="line">site.yml                  # master playbook 主 playbook</div><div class="line">webservers.yml            # playbook for webserver tier Web 服务器的 playbook</div><div class="line">dbservers.yml             # playbook for dbserver tier 数据库服务器的 playbook</div><div class="line"></div><div class="line">roles/</div><div class="line">    common/               # this hierarchy represents a &quot;role&quot; 这里的结构代表了一个 &quot;role&quot;</div><div class="line">        tasks/            #</div><div class="line">            main.yml      #  &lt;-- tasks file can include smaller files if warranted</div><div class="line">        handlers/         #</div><div class="line">            main.yml      #  &lt;-- handlers file</div><div class="line">        templates/        #  &lt;-- files for use with the template resource</div><div class="line">            ntp.conf.j2   #  &lt;------- templates end in .j2</div><div class="line">        files/            #</div><div class="line">            bar.txt       #  &lt;-- files for use with the copy resource</div><div class="line">            foo.sh        #  &lt;-- script files for use with the script resource</div><div class="line">        vars/             #</div><div class="line">            main.yml      #  &lt;-- variables associated with this role</div><div class="line">        defaults/         #</div><div class="line">            main.yml      #  &lt;-- default lower priority variables for this role</div><div class="line">        meta/             #</div><div class="line">            main.yml      #  &lt;-- role dependencies</div><div class="line"></div><div class="line">    webtier/              # same kind of structure as &quot;common&quot; was above, done for the webtier role</div><div class="line">    monitoring/           # &quot;&quot;</div><div class="line">    fooapp/               # &quot;&quot;</div></pre></td></tr></table></figure></p>
<h2 id="8-变量的定义"><a href="#8-变量的定义" class="headerlink" title="8. 变量的定义"></a>8. 变量的定义</h2><p>   可在hosts 定义  可在playbooks定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- hosts: webservers</div><div class="line">  vars:</div><div class="line">    http_port: 80</div></pre></td></tr></table></figure></p>
<p>在文件和roles中定义</p>
<p>使用变量 Jinja2方式<br><code>My amp goes to </code></p>
<h3 id="8-1-怎么使用变量。"><a href="#8-1-怎么使用变量。" class="headerlink" title="8.1 怎么使用变量。"></a>8.1 怎么使用变量。</h3><p>其中， <code>ansible all -m setup</code>  可以查看远程主机很多信息，可以使用和引用里面的变量。</p>
<h3 id="8-2-查看主机信息"><a href="#8-2-查看主机信息" class="headerlink" title="8.2 查看主机信息"></a>8.2 查看主机信息</h3><p> <code>ansible -i host tmp  -m setup</code><br>里面有很多变量信息，我们需要什么变量就取用就好<br>可以在playbook中这样引用以上例子中第一个硬盘的模型:<br><code></code><br>同样,作为系统报告的主机名如以下所示:<br><code></code><br>不合格的主机名显示了句号(.)之前的字符串:<br><code></code><br>在模板和条件判断(请看 playbook_conditionals )中会经常使用Facts.</p>
<h2 id="9-playbook的-条件语句（when）"><a href="#9-playbook的-条件语句（when）" class="headerlink" title="9. playbook的 条件语句（when）"></a>9. playbook的 条件语句（when）</h2><p>常常来说,一个play的结果经常取决于一个变量的值,事件（从远端系统得到事件）, 或者之前任务的结果.在有些情况下,<br>这些变量的值也会取决于其他变量. 进而,可以建立多余的组基于这些主机是否符合某些条件来操控主机, Ansible 提供了<br>很多不同选项,来控制执行流. 让我们详细看看这些都是啥.<br>when 语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tasks:</div><div class="line">  - name: &quot;shutdown Debian flavored systems&quot;</div><div class="line">    command: /sbin/shutdown -t now</div><div class="line">    when: ansible_os_family == &quot;Debian&quot;</div></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook zabbix-agent_allos.yaml -i test -b -K -C  #-C是测试看是否成功</div></pre></td></tr></table></figure></p>
<h2 id="10-标准循环-（with-itms）"><a href="#10-标准循环-（with-itms）" class="headerlink" title="10. 标准循环 （with_itms）"></a>10. 标准循环 （with_itms）</h2><p>为了保持简洁,重复的任务可以用以下简写的方式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- name: add several users</div><div class="line">  user: name=&#123;&#123; item &#125;&#125; state=present groups=wheel</div><div class="line">  with_items:</div><div class="line">     - testuser1</div><div class="line">     - testuser2</div></pre></td></tr></table></figure></p>
<p>如果你在变量文件中或者 ‘vars’ 区域定义了一组YAML列表,你也可以这样做:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">with_items: &quot;&#123;&#123;somelist&#125;&#125;&quot;</div></pre></td></tr></table></figure></p>
<p>以上写法与下面是完全等同的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- name: add user testuser1</div><div class="line">  user: name=testuser1 state=present groups=wheel</div><div class="line">- name: add user testuser2</div><div class="line">  user: name=testuser2 state=present groups=wheel</div></pre></td></tr></table></figure></p>
<p>或者   其中 with_itmes：是固定写发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- name: add several users</div><div class="line">  user: name=&#123;&#123; item.name &#125;&#125; state=present groups=&#123;&#123; item.groups &#125;&#125;</div><div class="line">  with_items:</div><div class="line">    - &#123; name: &apos;testuser1&apos;, groups: &apos;wheel&apos; &#125;</div><div class="line">    - &#123; name: &apos;testuser2&apos;, groups: &apos;root&apos; &#125;</div></pre></td></tr></table></figure></p>
<p>我的循环脚本：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: tmp</div><div class="line">  remote_user: app</div><div class="line">  sudo: yes</div><div class="line">  sudo_user: root</div><div class="line">  tasks:</div><div class="line">  - name: test</div><div class="line">    shell: echo "&#123;&#123; ansible_os_family &#125;&#125;" &gt;&gt; testdff</div><div class="line">    sudo: yes</div><div class="line">    when: ansible_os_family == "RedHat"</div><div class="line">  - name: hello_test</div><div class="line">    shell: echo "&#123;&#123; item.name &#125;&#125;" &gt;&gt; testdff</div><div class="line">    with_items:</div><div class="line">     - &#123; name: test0111111 &#125;</div><div class="line">     - &#123; name: test0222222 &#125;</div><div class="line">     - &#123; name: test0333333 &#125;</div></pre></td></tr></table></figure></p>
<h2 id="11-ymal-语法："><a href="#11-ymal-语法：" class="headerlink" title="11. ymal 语法："></a>11. ymal 语法：</h2><p>“—“代表 yaml文件的开始<br>基本的 YAML<br>对于 Ansible, 每一个 YAML 文件都是从一个列表开始. 列表中的每一项都是一个键值对, 通常它们被称为一个 “哈希” 或 “字典”. 所以, 我们需要知道如何在 YAML 中编写列表和字典.</p>
<p>YAML 还有一个小的怪癖. 所有的 YAML 文件(无论和 Ansible 有没有关系)开始行都应该是 —. 这是 YAML 格式的一部分, 表明一个文件的开始.</p>
<p>列表中的所有成员都开始于相同的缩进级别, 并且使用一个 “- “ 作为开头(一个横杠和一个空格):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"># 一个美味水果的列表</div><div class="line">- Apple</div><div class="line">- Orange</div><div class="line">- Strawberry</div><div class="line">- Mango</div><div class="line">一个字典是由一个简单的 键: 值 的形式组成(这个冒号后面必须是一个空格):</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"># 一位职工的记录</div><div class="line">name: Example Developer</div><div class="line">job: Developer</div><div class="line">skill: Elite</div></pre></td></tr></table></figure>
<p>字典也可以使用缩进形式来表示, 如果你喜欢这样的话:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"># 一位职工的记录</div><div class="line">&#123;name: Example Developer, job: Developer, skill: Elite&#125;</div></pre></td></tr></table></figure></p>
<p>Ansible并不是太多的使用这种格式, 但是你可以通过以下格式来指定一个布尔值(true/fase):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">create_key: yes</div><div class="line">needs_agent: no</div><div class="line">knows_oop: True</div><div class="line">likes_emacs: TRUE</div><div class="line">uses_cvs: false</div></pre></td></tr></table></figure></p>
<p>让我们把目前所学到的 YAML 例子组合在一起. 这些在 Ansible 中什么也干不了, 但这些格式将会给你感觉:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line"># 一位职工记录</div><div class="line">name: Example Developer</div><div class="line">job: Developer</div><div class="line">skill: Elite</div><div class="line">employed: True</div><div class="line">foods:</div><div class="line">    - Apple</div><div class="line">    - Orange</div><div class="line">    - Strawberry</div><div class="line">    - Mango</div><div class="line">languages:</div><div class="line">    ruby: Elite</div><div class="line">    python: Elite</div><div class="line">    dotnet: Lame</div></pre></td></tr></table></figure></p>
<ol>
<li>总结<br>由于公司运维已经使用到了ansible，在这里只了解了基本的playbook的when（条件）<br>我们需要了结几个大概。</li>
</ol>
<ul>
<li>ansible有两种方式 ansible 和 ansible-playbooks</li>
<li>我控制远程主机，需要定义我要控制那些主机。（写在inventory文件里面，也是hosts文件）</li>
<li>hosts主机文件里面，可以定义组。组里面可以定义一些变量。以及端口，用户和密码等</li>
<li>playbooks 的ymal文件。里面用一个<code>-</code>或者<code> </code>来控制等级。</li>
<li>playbooks 等级为:playbooks –&gt; plays –&gt;tasts –&gt; name(一个name只有一个模块) </li>
<li>在下ymal文件供使用时，我们需要常常获取远程控制主机的信息。可以通过<code>ansible -i host tmp  -m setup</code> 来获取变量名。</li>
<li>ymal文件中，使用when 来控制条件。条件控制变量通过上一条获取。</li>
<li>ymal文件中，使用with_itms来循环。</li>
<li>目前工作就使用到这些</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/10/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZingsMan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZingsMan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/10/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T21:58:24+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
<h3 id="Tables"><a href="#Tables" class="headerlink" title="Tables"></a>Tables</h3><table>
<thead>
<tr>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>xiao</td>
<td>13</td>
</tr>
<tr>
<td>ming</td>
<td>15</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="ZingsMan" />
          <p class="site-author-name" itemprop="name">ZingsMan</p>
           
              <p class="site-description motion-element" itemprop="description">业精于勤荒于嬉,行成于思毁于随。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zingsman" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/zingsman" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zingsman" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZingsMan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
